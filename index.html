
<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù‚Ù‡Ø±Ù…Ø§Ù† Ø³Ù„Ø§Ù…Øª</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn-font@v33.003/Vazirmatn-font-face.css" rel="stylesheet" type="text/css" />
    <style>
        body { 
            font-family: 'Vazirmatn', sans-serif; 
            scroll-behavior: smooth;
            color: #334155; /* text-slate-700 */
            background-color: #f0f9ff; /* bg-sky-50, very light blue */
            overflow: hidden; /* Prevent body scroll on desktop */
        }
        .app-frame {
            max-width: 420px;
            width: 100%;
            height: 95vh; /* Adjusted for better screen fit */
            max-height: 850px;
        }
        .draggable { cursor: grab; user-select: none; transition: all 0.2s; }
        .draggable:active { cursor: grabbing; transform: scale(1.05); box-shadow: 0 4px 8px rgba(0,0,0,0.2); z-index: 10; }
        .dropzone {
            border: 2px dashed #cbd5e1; /* slate-300 */
            transition: background-color 0.2s ease, border-color 0.2s ease;
            border-radius: 0.75rem;
        }
        .dropzone.hover { background-color: #e0f2fe; border-color: #3b82f6; }
        .modal {
            display: none;
            position: fixed; z-index: 1000; left: 0; top: 0;
            width: 100%; height: 100%;
            background-color: rgba(15, 23, 42, 0.6);
            align-items: center; justify-content: center;
            backdrop-filter: blur(4px);
        }
        @keyframes modal-appear {
            from { opacity: 0; transform: translateY(20px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        .modal-content {
            background-color: #ffffff; margin: auto; padding: 2rem;
            width: 90%; max-width: 450px; border-radius: 1rem;
            text-align: center; box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
            animation: modal-appear 0.3s ease-out forwards;
        }
        .btn {
            font-weight: 600; padding: 0.625rem 1.5rem; border-radius: 0.5rem; border: none; cursor: pointer;
            box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
            transition: all 0.2s ease-in-out;
            display: inline-flex; align-items: center; justify-content: center;
        }
        .btn:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); }
        .btn:disabled { background-color: #9ca3af; cursor: not-allowed; }
        .btn-primary { background-color: #3b82f6; color: white; }
        .btn-primary:hover:not(:disabled) { background-color: #2563eb; }
        .btn-secondary { background-color: #e5e7eb; color: #374151; }
        .btn-secondary:hover { background-color: #d1d5db; }

        .story-section { padding: 1.5rem; border: 1px solid #e2e8f0; border-radius: 1rem; background-color: #ffffff; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .qa-option {
            width: 100%; text-align: right; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 0.5rem;
            background-color: white; transition: all 0.2s ease;
        }
        .qa-option:hover:not(:disabled) { background-color: #f3f4f6; transform: translateY(-2px); }
        .qa-option.correct { background-color: #dcfce7; border-color: #22c55e; font-weight: 700; color: #166534; }
        .qa-option.incorrect { background-color: #fee2e2; border-color: #ef4444; font-weight: 700; color: #991b1b; }
        .qa-option:disabled { opacity: 0.7; cursor: not-allowed; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
        @keyframes pulseOnce { 0% { transform: scale(1); } 50% { transform: scale(1.2); } 100% { transform: scale(1); } }
        .animate-pulse-once { animation: pulseOnce 0.5s ease-out; }


        /* New Map Styles */
        .map-location {
            position: relative; /* Changed from absolute */
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            text-align: center;
            transition: transform 0.3s ease, filter 0.3s ease;
            filter: drop-shadow(0 4px 3px rgba(0,0,0,0.2));
        }

        .map-location:hover {
            transform: scale(1.1);
            filter: drop-shadow(0 8px 6px rgba(0,0,0,0.25));
        }

        .map-location .icon-container {
            width: 72px; /* Increased size */
            height: 72px; /* Increased size */
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem; /* text-4xl */
            color: white;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            border: 4px solid white;
        }

        .map-location .title-container {
            margin-top: 0.5rem; /* Increased margin */
            background-color: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(2px);
            padding: 0.25rem 0.75rem; /* Increased padding */
            border-radius: 0.75rem; /* More rounded */
            font-size: 0.875rem; /* text-sm */
            font-weight: 700; /* font-bold */
            color: #334155; /* text-slate-700 */
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
    </style>
<script type="importmap">
{
  "imports": {
    "@google/genai": "https://esm.sh/@google/genai@^1.11.0"
  }
}
</script>
</head>
<body class="selection:bg-amber-300 selection:text-amber-900 flex items-center justify-center min-h-screen">
    <div id="app-container" class="app-frame bg-white rounded-3xl shadow-2xl flex flex-col overflow-hidden relative">
        
        <!-- HEADER -->
        <header class="w-full py-3 px-4 shrink-0 border-b border-slate-300 flex justify-between items-center bg-slate-200 z-10">
            <h1 class="text-xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-500 to-emerald-500">Ù‚Ù‡Ø±Ù…Ø§Ù† Ø³Ù„Ø§Ù…Øª</h1>
            <div id="header-stats" class="flex items-center gap-4">
                <div class="flex items-center gap-2">
                    <span class="font-bold text-slate-700 text-lg" id="total-score">0</span>
                    <span class="text-sm text-slate-500">Ø§Ù…ØªÛŒØ§Ø²</span>
                </div>
                <button id="medals-btn" class="p-2 rounded-full hover:bg-amber-100 transition-colors">
                    <svg class="w-7 h-7 text-amber-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M15.89 4.11a1 1 0 00-1.412 0l-4.48 4.48-1.59-1.59a1 1 0 00-1.414 1.414l2.293 2.293a1 1 0 001.414 0l5.187-5.187a1 1 0 000-1.414zM10 2a8 8 0 100 16 8 8 0 000-16zM5.96 14.33a6.004 6.004 0 017.07-9.596 6 6 0 11-7.07 9.596z" clip-rule="evenodd" /></svg>
                </button>
            </div>
        </header>

        <!-- MAIN AREA -->
        <main id="main-content" class="flex-1 overflow-y-auto relative">
            <!-- Adventure Map Screen -->
            <div id="adventure-map-container" class="w-full h-full relative overflow-hidden flex flex-col justify-center items-center">
                <div id="welcome-banner" class="absolute top-4 right-2 left-2 text-center p-2 bg-white/70 backdrop-blur-sm rounded-xl z-10">
                    <p id="welcome-message" class="text-slate-600 font-semibold text-sm">Ø³Ù„Ø§Ù… Ù‚Ù‡Ø±Ù…Ø§Ù† Ú©ÙˆÚ†Ú©!</p>
                </div>
                <div id="story-locations" class="relative z-10 flex flex-wrap justify-center items-center gap-x-4 gap-y-8 p-6">
                    <!-- Story locations are generated by JS -->
                </div>
            </div>

            <!-- Story Screen (initially hidden) -->
            <section id="story-screen" class="hidden absolute inset-0 bg-slate-50 w-full h-full flex flex-col p-4 z-30">
                <div class="flex justify-between items-center mb-4 shrink-0">
                    <h3 id="story-title" class="text-2xl font-extrabold text-slate-800"></h3>
                    <button id="home-btn" class="p-2 rounded-full hover:bg-slate-200 transition-colors">
                        <svg class="w-7 h-7 text-slate-600" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h7.5" /></svg>
                    </button>
                </div>
                <p id="story-character-intro" class="text-md text-slate-500 mb-6 italic text-center shrink-0"></p>
                <div id="story-content-container" class="flex-1 space-y-8 overflow-y-auto pr-2">
                    <!-- Story content is generated by JS -->
                </div>
            </section>
        </main>

        <!-- FOOTER -->
        <footer id="app-footer" class="shrink-0 border-t border-slate-300 flex justify-around items-center py-2 bg-slate-200 z-20">
            <button id="chatbot-map-toggle" class="flex flex-col items-center gap-1 text-slate-600 hover:text-blue-500 transition-colors p-2 rounded-lg">
                <svg class="w-7 h-7" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 7.5V6.108c0-1.135.845-2.098 1.976-2.192.373-.03.748-.057 1.123-.08M15.75 18H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08M15.75 18.75v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5A3.375 3.375 0 006.375 7.5H5.25m11.9-3.664A2.251 2.251 0 0015 2.25h-1.5a2.251 2.251 0 00-2.15 1.586m5.8 0c.065.21.1.433.1.664v.75h-6v-.75c0-.231.035-.454.1-.664M6.75 7.5H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V16.5" /></svg>
                <span class="text-xs font-semibold">Ù…Ø±Ø¨ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯</span>
            </button>
            <button id="about-map-toggle" class="flex flex-col items-center gap-1 text-slate-600 hover:text-violet-500 transition-colors p-2 rounded-lg">
                 <svg class="w-7 h-7" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                 <span class="text-xs font-semibold">Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ø§</span>
            </button>
        </footer>
        
        <!-- MODALS -->
        <div id="feedback-modal" class="modal">
            <div class="modal-content">
                <p id="modal-message" class="text-lg font-bold text-slate-800"></p>
                <button id="close-modal" class="btn btn-primary mt-6 w-full">Ø¨Ø§Ø´Ù‡!</button>
            </div>
        </div>

        <div id="welcome-modal" class="modal" style="display: none;">
             <div class="modal-content">
                <h2 class="text-2xl font-bold text-slate-800 mb-4">Ø¨Ù‡ Ù‚Ù‡Ø±Ù…Ø§Ù† Ø³Ù„Ø§Ù…Øª Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒ!</h2>
                <p class="text-slate-600 mb-6">Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ Ù…Ø§Ø¬Ø±Ø§Ø¬ÙˆÛŒÛŒØŒ Ø§Ø³Ù…Øª Ø±Ùˆ Ø¨Ù‡ Ù…Ø§ Ø¨Ú¯Ùˆ:</p>
                <input type="text" id="name-input" placeholder="Ù†Ø§Ù… Ù‚Ù‡Ø±Ù…Ø§Ù†" class="w-full p-3 border border-slate-300 rounded-lg text-center"/>
                <button id="start-adventure-btn" class="btn btn-primary mt-4 w-full">Ø´Ø±ÙˆØ¹ Ù…Ø§Ø¬Ø±Ø§Ø¬ÙˆÛŒÛŒ</button>
            </div>
        </div>

        <div id="chatbot-modal" class="modal">
             <div class="modal-content !max-w-md !w-full !h-4/5 flex flex-col">
                <h3 class="text-xl font-bold text-slate-800 mb-4 shrink-0">Ù…Ø±Ø¨ÛŒ Ø³Ù„Ø§Ù…Øª Ù‡ÙˆØ´Ù…Ù†Ø¯</h3>
                <div id="chat-messages" class="flex-1 overflow-y-auto bg-slate-100 p-3 rounded-lg text-right space-y-3"></div>
                <div class="mt-4 flex gap-2 shrink-0">
                    <input type="text" id="chat-input" placeholder="Ø³Ø¤Ø§Ù„Øª Ø±Ùˆ Ø¨Ù¾Ø±Ø³..." class="flex-1 p-2 border border-slate-300 rounded-lg"/>
                    <button id="chat-send-btn" class="btn btn-primary">Ø¨Ù¾Ø±Ø³</button>
                </div>
            </div>
        </div>

        <div id="medals-modal" class="modal">
            <div class="modal-content">
               <h2 class="text-xl font-bold text-slate-800 mb-6 text-center">Ú¯Ø§Ù„Ø±ÛŒ Ù…Ø¯Ø§Ù„â€ŒÙ‡Ø§</h2>
               <div id="medal-gallery-content" class="grid grid-cols-3 sm:grid-cols-4 gap-4 justify-items-center"></div>
                <button id="close-medals-modal" class="btn btn-primary mt-8 w-full">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
           </div>
       </div>

       <div id="about-modal" class="modal">
            <div class="modal-content">
                <h2 class="text-xl font-bold text-slate-800 mb-4 text-center">Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ø§ Ùˆ Ù…Ù†Ø§Ø¨Ø¹</h2>
                <div class="text-right space-y-4 text-slate-600 text-sm bg-slate-50 p-4 rounded-lg">
                    <p>Ø§ÛŒÙ† Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† ÛŒÚ© Ø§Ø¨Ø²Ø§Ø± Ø¢Ù…ÙˆØ²Ø´ÛŒ Ø¨Ø§Ø²ÛŒâ€ŒÙˆØ§Ø± Ø´Ø¯Ù‡ Ø§Ø³Øª Ú©Ù‡ Ø¨Ù‡ Ú©ÙˆØ¯Ú©Ø§Ù† Ø¯Ø¨Ø³ØªØ§Ù†ÛŒ Ú©Ù…Ú© Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ù…Ù‡Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø¶Ø±ÙˆØ±ÛŒ Ø³Ù„Ø§Ù…ØªÛŒ Ø±Ø§ Ø¨ÛŒØ§Ù…ÙˆØ²Ù†Ø¯. Ù…Ø­ØªÙˆØ§ÛŒ Ø§ÛŒÙ† ÙˆØ¨ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ø¨Ø±Ú¯Ø±ÙØªÙ‡ Ø§Ø² Ø±Ø³Ø§Ù„Ù‡ Ø¯Ú©ØªØ±ÛŒ Ø¯Ø± Ø²Ù…ÛŒÙ†Ù‡ Ø±ÙØªØ§Ø±Ù‡Ø§ÛŒ ØªØºØ°ÛŒÙ‡â€ŒØ§ÛŒ Ø§Ø³Øª Ú©Ù‡ ØªØ­Øª Ø­Ù…Ø§ÛŒØª Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡ ØªØ±Ø¨ÛŒØª Ù…Ø¯Ø±Ø³ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯Ù‡ Ø§Ø³Øª.</p>
                    <p><strong>Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ù…Ø§:</strong> n.mehrjuyan@gmail.com, f.zarei@modares.ac.ir</p>
                </div>
                 <button id="change-name-btn" class="btn btn-secondary mt-6 w-full">ØªØºÛŒÛŒØ± Ù†Ø§Ù…</button>
                 <button id="close-about-modal" class="btn btn-primary mt-2 w-full">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
            </div>
        </div>

    </div>
    <script type="module">
        import { GoogleGenAI } from "@google/genai";
        // --- DATA & STATE ---
        const MEDAL_THRESHOLDS = [
            { name: "Ù†Ø´Ø§Ù† Ø¨Ø±Ù†Ø²", score: 50, color: "#CD7F32", unlocked: false },
            { name: "Ù†Ø´Ø§Ù† Ù†Ù‚Ø±Ù‡", score: 150, color: "#A0AEC0", unlocked: false },
            { name: "Ù†Ø´Ø§Ù† Ø·Ù„Ø§", score: 300, color: "#FBBF24", unlocked: false },
            { name: "Ù‚Ù‡Ø±Ù…Ø§Ù† ØªÙ†Ø¯Ø±Ø³ØªÛŒ", score: 500, color: "#4ade80", unlocked: false }
        ];
        let totalScore = 0;
        let currentStoryId = null;
        let userName = "Ù‚Ù‡Ø±Ù…Ø§Ù†";
        let chat = null;
        const storiesData = [
            { id: 1, title: "Ø´Ù‡Ø± Ø®ÙˆØ±Ø§Ú©ÛŒâ€ŒÙ‡Ø§", icon: "ğŸ", themeColor: "bg-gradient-to-br from-red-500 to-orange-400", characterIntro: "Ø¨Ø§ Ø¢Ø±ÛŒÙ†ØŒ Ø³Ø§Ø±Ø§ Ùˆ Ù¾Ø±ÙˆØ§Ù†Ù‡ Ø³Ù„Ø§Ù…ØªÛŒ Ù‡Ù…Ø±Ø§Ù‡ Ø´ÙˆÛŒØ¯...", content: [
                    { type: "narrative", title: "Ø¯Ø¹ÙˆØª Ø¨Ù‡ ÛŒÚ© Ù…Ø§Ø¬Ø±Ø§Ø¬ÙˆÛŒÛŒ Ø¬Ø§Ø¯ÙˆÛŒÛŒ", text: "Ø¯Ø± ÛŒÚ© Ø±ÙˆØ² Ø¢ÙØªØ§Ø¨ÛŒ Ø¨Ù‡Ø§Ø±ÛŒØŒ Ø¢Ø±ÛŒÙ† Ùˆ Ø³Ø§Ø±Ø§ØŒ Ø¯Ùˆ Ø¯ÙˆØ³Øª 8 Ø³Ø§Ù„Ù‡ØŒ Ø¯Ø± Ø­ÛŒØ§Ø· Ù…Ø¯Ø±Ø³Ù‡ Ù…Ø´ØºÙˆÙ„ Ø¨Ø§Ø²ÛŒ Ø¨Ø§ ÛŒÚ© ØªÙˆÙ¾ Ø±Ù†Ú¯Ø§Ø±Ù†Ú¯ Ø¨ÙˆØ¯Ù†Ø¯. Ù†Ø§Ú¯Ù‡Ø§Ù†ØŒ Ù¾Ø±ÙˆØ§Ù†Ù‡â€ŒØ§ÛŒ Ø¯Ø±Ø®Ø´Ø§Ù† Ø¨Ø§ Ø¨Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ø±Ù†Ú¯ÛŒÙ†â€ŒÚ©Ù…Ø§Ù†ÛŒ Ø§Ø² Ù…ÛŒØ§Ù† Ú¯Ù„â€ŒÙ‡Ø§ Ù¾Ø±ÙˆØ§Ø² Ú©Ø±Ø¯ Ùˆ Ø¬Ù„ÙˆÛŒ Ø¢Ù†â€ŒÙ‡Ø§ ÙØ±ÙˆØ¯ Ø¢Ù…Ø¯. Ù¾Ø±ÙˆØ§Ù†Ù‡ Ø¨Ø§ ØµØ¯Ø§ÛŒÛŒ Ù†Ø±Ù… Ùˆ Ù…Ù‡Ø±Ø¨Ø§Ù† Ú¯ÙØª: Â«Ø³Ù„Ø§Ù…ØŒ Ù‚Ù‡Ø±Ù…Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ú©ÙˆÚ†Ú©! Ù…Ù† Ù¾Ø±ÙˆØ§Ù†Ù‡ Ø³Ù„Ø§Ù…ØªÛŒâ€ŒØ§Ù…. Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø¨Ù‡ Ø´Ù‡Ø± Ø®ÙˆØ±Ø§Ú©ÛŒâ€ŒÙ‡Ø§ Ø³ÙØ± Ú©Ù†ÛŒØ¯ØŸ Ø¬Ø§ÛŒÛŒ Ú©Ù‡ ÛŒØ§Ø¯ Ù…ÛŒâ€ŒÚ¯ÛŒØ±ÛŒØ¯ Ú†Ø·ÙˆØ± Ø¨Ø¯Ù†ÛŒ Ù‚ÙˆÛŒØŒ Ø°Ù‡Ù†ÛŒ Ø´Ø§Ø¯ Ùˆ Ø§Ù†Ø±Ú˜ÛŒ Ø¨ÛŒâ€ŒÙ¾Ø§ÛŒØ§Ù† Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´ÛŒØ¯!Â»\nØ¢Ø±ÛŒÙ† Ø¨Ø§ Ú†Ø´Ù…Ø§Ù† Ø¨Ø±Ø§Ù‚ Ú¯ÙØª: Â«Ø´Ù‡Ø± Ø®ÙˆØ±Ø§Ú©ÛŒâ€ŒÙ‡Ø§ØŸ ÛŒØ¹Ù†ÛŒ Ú†ÛŒØŸÂ» Ø³Ø§Ø±Ø§ Ø®Ù†Ø¯ÛŒØ¯ Ùˆ Ú¯ÙØª: Â«ÙÚ©Ø± Ú©Ù†Ù… ÛŒÙ‡ Ø¬Ø§ÛŒ Ù¾Ø± Ø§Ø² Ø´Ú©Ù„Ø§ØªÙ‡!Â» Ù¾Ø±ÙˆØ§Ù†Ù‡ Ø¨Ø§Ù„â€ŒÙ‡Ø§ÛŒØ´ Ø±Ø§ ØªÚ©Ø§Ù† Ø¯Ø§Ø¯ Ùˆ Ø¨Ø§ Ø®Ù†Ø¯Ù‡ Ú¯ÙØª: Â«Ù†Ù‡ Ø¯Ù‚ÛŒÙ‚Ø§Ù‹! Ø¨ÛŒØ§ÛŒÛŒØ¯ Ø¨Ø¨ÛŒÙ†ÛŒØ¯!Â» Ø¨Ø§ ÛŒÚ© Ú†Ø±Ø®Ø´ Ø¬Ø§Ø¯ÙˆÛŒÛŒØŒ Ú¯Ø±Ø¯Ø¨Ø§Ø¯ÛŒ Ø§Ø² Ù†ÙˆØ± Ø¢Ù†â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ù‡ Ø¯Ù†ÛŒØ§ÛŒÛŒ Ø¹Ø¬ÛŒØ¨ Ø¨Ø±Ø¯Ø› Ø´Ù‡Ø±ÛŒ Ú©Ù‡ Ø®ÛŒØ§Ø¨Ø§Ù†â€ŒÙ‡Ø§ÛŒØ´ Ø§Ø² Ù†Ø§Ù† Ø³Ø¨ÙˆØ³â€ŒØ¯Ø§Ø±ØŒ Ø¯Ø±Ø®ØªØ§Ù†Ø´ Ø§Ø² Ù…ÛŒÙˆÙ‡â€ŒÙ‡Ø§ÛŒ Ø±Ù†Ú¯Ø§Ø±Ù†Ú¯ Ùˆ Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒØ´ Ø§Ø² Ù¾Ù†ÛŒØ± Ùˆ Ù…Ø§Ø³Øª Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯Ù‡ Ø¨ÙˆØ¯!\nÙ¾Ø±ÙˆØ§Ù†Ù‡ ØªÙˆØ¶ÛŒØ­ Ø¯Ø§Ø¯: Â«Ø§ÛŒÙ†Ø¬Ø§ Ø´Ù‡Ø± Ø®ÙˆØ±Ø§Ú©ÛŒâ€ŒÙ‡Ø§Ø³ØªØŒ Ù…Ø«Ù„ ÛŒÚ© Ù†Ù‚Ø´Ù‡ Ø¬Ø§Ø¯ÙˆÛŒÛŒ Ø¨Ø±Ø§ÛŒ Ø³Ù„Ø§Ù…ØªÛŒ! Ù‡Ø± Ø¨Ø®Ø´ Ø´Ù‡Ø± ÛŒÚ© Ú¯Ø±ÙˆÙ‡ ØºØ°Ø§ÛŒÛŒÙ‡ Ú©Ù‡ Ø¨Ø¯Ù† Ø´Ù…Ø§ Ø±Ùˆ Ù‚ÙˆÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ù‡. Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ§ÛŒØ¯ Ù…Ø§Ø¬Ø±Ø§Ø¬ÙˆÛŒÛŒ Ø±Ùˆ Ø´Ø±ÙˆØ¹ Ú©Ù†ÛŒØ¯ØŸÂ»", tip: "Ø´Ù‡Ø± Ø®ÙˆØ±Ø§Ú©ÛŒâ€ŒÙ‡Ø§ Ø§Ø³ØªØ¹Ø§Ø±Ù‡â€ŒØ§ÛŒ Ø§Ø² Ù‡Ø±Ù… ØºØ°Ø§ÛŒÛŒ Ø§Ø³Øª Ú©Ù‡ Ú©ÙˆØ¯Ú©Ø§Ù† Ø±Ø§ Ø¨Ø§ Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§ÛŒ ØºØ°Ø§ÛŒÛŒ Ùˆ Ø§Ù‡Ù…ÛŒØª ØªØºØ°ÛŒÙ‡ Ù…ØªØ¹Ø§Ø¯Ù„ Ø¢Ø´Ù†Ø§ Ù…ÛŒâ€ŒÚ©Ù†Ø¯." },
                    { type: "qa", title: "Ø¢Ø²Ù…ÙˆÙ† Ø®ÙˆØ±Ø§Ú©ÛŒâ€ŒÙ‡Ø§", questions: [{ q: "Ú©Ø¯Ø§Ù… Ú¯Ø±ÙˆÙ‡ ØºØ°Ø§ÛŒÛŒ Ù…Ù†Ø¨Ø¹ Ø§ØµÙ„ÛŒ Ø§Ù†Ø±Ú˜ÛŒ Ø¨Ø¯Ù† Ø§Ø³ØªØŸ", options: ["Ù¾Ø±ÙˆØªØ¦ÛŒÙ†â€ŒÙ‡Ø§", "ØºÙ„Ø§Øª Ùˆ Ù†Ø§Ù†", "Ù„Ø¨Ù†ÛŒØ§Øª"], correct: "ØºÙ„Ø§Øª Ùˆ Ù†Ø§Ù†", points: 10 }] },
                    { type: "dragDrop", title: "Ù‡Ø±Ù… ØºØ°Ø§ÛŒÛŒ", question: "Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§ÛŒ ØºØ°Ø§ÛŒÛŒ Ø²ÛŒØ± Ø±Ø§ Ø¨Ù‡ Ø¬Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø±Ø³Øª Ø¯Ø± Ù‡Ø±Ù… ØºØ°Ø§ÛŒÛŒ Ø¨Ú©Ø´ÛŒØ¯.", items: [{ id: "fruit", text: "Ù…ÛŒÙˆÙ‡â€ŒÙ‡Ø§ Ùˆ Ø³Ø¨Ø²ÛŒØ¬Ø§Øª", category: "base" }, { id: "grain", text: "ØºÙ„Ø§Øª", category: "base" }, { id: "protein", text: "Ù¾Ø±ÙˆØªØ¦ÛŒÙ†â€ŒÙ‡Ø§ Ùˆ Ù„Ø¨Ù†ÛŒØ§Øª", category: "middle" }, { id: "fats", text: "Ú†Ø±Ø¨ÛŒâ€ŒÙ‡Ø§ Ùˆ Ø´ÛŒØ±ÛŒÙ†ÛŒâ€ŒÙ‡Ø§", category: "top" }], dropzones: [{ id: "zone-base", text: "Ù‚Ø§Ø¹Ø¯Ù‡ Ù‡Ø±Ù… (Ø¨ÛŒØ´ØªØ±ÛŒÙ† Ù…ØµØ±Ù)", accepts: "base" }, { id: "zone-middle", text: "ÙˆØ³Ø· Ù‡Ø±Ù… (Ù…ØµØ±Ù Ù…ØªØ¹Ø§Ø¯Ù„)", accepts: "middle" }, { id: "zone-top", text: "Ù†ÙˆÚ© Ù‡Ø±Ù… (Ú©Ù…ØªØ±ÛŒÙ† Ù…ØµØ±Ù)", accepts: "top" }], points: 20 }
            ] },
            { id: 2, title: "Ù‚Ù‡Ø±Ù…Ø§Ù†Ø§Ù† ÙˆØ±Ø²Ø´Ú©Ø§Ø±", icon: "âš½ï¸", themeColor: "bg-gradient-to-br from-sky-500 to-indigo-500", characterIntro: "Ø¨Ø§ Ù†ÛŒÚ©Ø§ØŒ Ú©Ø³Ø±ÛŒ Ùˆ Ø¹Ù‚Ø§Ø¨ Ø³Ù„Ø§Ù…ØªÛŒ Ù‡Ù…Ø±Ø§Ù‡ Ø´ÙˆÛŒØ¯...", content: [
                    { type: "narrative", title: "Ø¯Ø¹ÙˆØª Ø¨Ù‡ Ø¬Ø²ÛŒØ±Ù‡ Ø³Ù„Ø§Ù…ØªÛŒ", text: "Ø¯Ø± ÛŒÚ© Ø±ÙˆØ² Ø¨Ù‡Ø§Ø±ÛŒØŒ Ù†ÛŒÚ©Ø§ Ùˆ Ú©Ø³Ø±ÛŒØŒ Ø¯Ùˆ Ø¯ÙˆØ³Øª 9 Ø³Ø§Ù„Ù‡ØŒ Ø¯Ø± Ù¾Ø§Ø±Ú© Ù†Ø²Ø¯ÛŒÚ© Ù…Ø¯Ø±Ø³Ù‡ Ù…Ø´ØºÙˆÙ„ Ø¨Ø§Ø²ÛŒ Ø¨ÙˆØ¯Ù†Ø¯. Ù†Ø§Ú¯Ù‡Ø§Ù†ØŒ ÛŒÚ© Ø¹Ù‚Ø§Ø¨ Ø·Ù„Ø§ÛŒÛŒ Ø§Ø² Ø¢Ø³Ù…Ø§Ù† Ù¾Ø§ÛŒÛŒÙ† Ø¢Ù…Ø¯ Ùˆ Ú¯ÙØª: Â«Ù…Ù† Ø¹Ù‚Ø§Ø¨ Ø³Ù„Ø§Ù…ØªÛŒâ€ŒØ§Ù…! Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø¨Ù‡ Ø¬Ø²ÛŒØ±Ù‡ Ø³Ù„Ø§Ù…ØªÛŒ Ø³ÙØ± Ú©Ù†ÛŒØ¯ Ùˆ ÛŒØ§Ø¯ Ø¨Ú¯ÛŒØ±ÛŒØ¯ Ú†Ø·ÙˆØ± Ù‚ÙˆÛŒØŒ Ø´Ø§Ø¯ Ùˆ Ø¨Ø§Ù‡ÙˆØ´ Ø¨Ù…Ø§Ù†ÛŒØ¯ØŸÂ» Ù†ÛŒÚ©Ø§ Ùˆ Ú©Ø³Ø±ÛŒ Ø¨Ø§ Ù‡ÛŒØ¬Ø§Ù† ÙØ±ÛŒØ§Ø¯ Ø²Ø¯Ù†Ø¯: Â«Ø¢Ø±Ù‡ØŒ Ø®ÛŒÙ„ÛŒ Ø¯ÙˆØ³Øª Ø¯Ø§Ø±ÛŒÙ…!Â» Ø¹Ù‚Ø§Ø¨ Ø¨Ø§Ù„â€ŒÙ‡Ø§ÛŒØ´ Ø±Ø§ ØªÚ©Ø§Ù† Ø¯Ø§Ø¯ Ùˆ Ø¢Ù†Ù‡Ø§ Ø±Ø§ Ø¨Ù‡ Ø¬Ø²ÛŒØ±Ù‡â€ŒØ§ÛŒ Ø¬Ø§Ø¯ÙˆÛŒÛŒ Ø¨Ø±Ø¯ØŒ Ø¬Ø§ÛŒÛŒ Ú©Ù‡ Ù‡Ù…Ù‡â€ŒÚ†ÛŒØ² Ù¾Ø± Ø§Ø² Ø§Ù†Ø±Ú˜ÛŒ Ùˆ Ø­Ø±Ú©Øª Ø¨ÙˆØ¯!\nØ¹Ù‚Ø§Ø¨ Ú¯ÙØª: Â«Ø§ÛŒÙ†Ø¬Ø§ Ø¬Ø²ÛŒØ±Ù‡ Ø³Ù„Ø§Ù…ØªÛŒÙ‡! Ù‡Ø± Ú¯ÙˆØ´Ù‡â€ŒØ§Ø´ ÛŒÙ‡ Ø±Ø§Ø² Ø¨Ø±Ø§ÛŒ Ù‚ÙˆÛŒ Ùˆ Ø´Ø§Ø¯ Ù…ÙˆÙ†Ø¯Ù† Ø¯Ø§Ø±Ù‡. Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ§ÛŒØ¯ Ú©Ø´ÙØ´ Ú©Ù†ÛŒØ¯ØŸÂ»", tip: "Ù…Ø¹Ø±ÙÛŒ Ø¬Ø²ÛŒØ±Ù‡ Ø³Ù„Ø§Ù…ØªÛŒ Ø¨Ù‡â€ŒØ¹Ù†ÙˆØ§Ù† Ø§Ø³ØªØ¹Ø§Ø±Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ ÙÙˆØ§ÛŒØ¯ ÙˆØ±Ø²Ø´ØŒ Ú©Ù‡ Ú©ÙˆØ¯Ú©Ø§Ù† Ø±Ø§ Ø¨Ø§ Ø§Ù‡Ù…ÛŒØª ÙØ¹Ø§Ù„ÛŒØª Ø¨Ø¯Ù†ÛŒ Ø¢Ø´Ù†Ø§ Ù…ÛŒâ€ŒÚ©Ù†Ø¯." },
                    { type: "qa", title: "Ø¢Ø²Ù…ÙˆÙ† ÙˆØ±Ø²Ø´", questions: [{ q: "ÙˆØ±Ø²Ø´ Ú©Ø±Ø¯Ù† Ú©Ø¯Ø§Ù… Ù‚Ø³Ù…Øª Ø¨Ø¯Ù† Ø±Ø§ Ù…Ø«Ù„ ÛŒÚ© Ù¾Ù…Ù¾ Ù‚ÙˆÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ØŸ", options: ["Ù…ØºØ²", "Ù‚Ù„Ø¨", "Ù¾Ø§Ù‡Ø§"], correct: "Ù‚Ù„Ø¨", points: 10 }] },
                    { type: "dragDrop", title: "ÙˆØ³Ø§ÛŒÙ„ ÙˆØ±Ø²Ø´ÛŒ", question: "Ù‡Ø± ÙˆØ³ÛŒÙ„Ù‡ Ø§ÛŒÙ…Ù†ÛŒ Ø±Ø§ Ø¨Ù‡ ÙˆØ±Ø²Ø´ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ø¢Ù† ÙˆØµÙ„ Ú©Ù†.", items: [{ id: "helmet", text: "Ú©Ù„Ø§Ù‡ Ø§ÛŒÙ…Ù†ÛŒ", category: "cycling" }, { id: "pads", text: "Ø²Ø§Ù†ÙˆØ¨Ù†Ø¯", category: "skating" }, { id: "goggles", text: "Ø¹ÛŒÙ†Ú© Ø´Ù†Ø§", category: "swimming" }], dropzones: [{ id: "dz-cycling", text: "Ø¯ÙˆÚ†Ø±Ø®Ù‡â€ŒØ³ÙˆØ§Ø±ÛŒ", accepts: "cycling" }, { id: "dz-skating", text: "Ø§Ø³Ú©ÛŒØªâ€ŒØ³ÙˆØ§Ø±ÛŒ", accepts: "skating" }, { id: "dz-swimming", text: "Ø´Ù†Ø§", accepts: "swimming" }], points: 15 }
            ] },
            { id: 3, title: "Ø´Ú©Ø§Ø±Ú†ÛŒØ§Ù† Ù…ÛŒÚ©Ø±ÙˆØ¨", icon: "ğŸ§¼", themeColor: "bg-gradient-to-br from-teal-400 to-cyan-500", characterIntro: "Ø¨Ø§ Ø¢ÙˆØ§ØŒ Ø¢Ø±ØªÛŒÙ† Ùˆ Ø­Ø¨Ø§Ø¨ Ø´Ø¬Ø§Ø¹ Ù‡Ù…Ø±Ø§Ù‡ Ø´ÙˆÛŒØ¯...", content: [
                    { type: "narrative", title: "Ø¯Ø¹ÙˆØª Ø¨Ù‡ Ø´Ù‡Ø± ØªÙ…ÛŒØ²", text: "Ø±ÙˆØ²ÛŒ Ø¢ÙˆØ§ Ùˆ Ø¢Ø±ØªÛŒÙ†ØŒ Ø¯Ùˆ Ø¯ÙˆØ³Øª 8 Ø³Ø§Ù„Ù‡ØŒ Ø¯Ø± Ø­ÛŒØ§Ø· Ù…Ø¯Ø±Ø³Ù‡ Ù…Ø´ØºÙˆÙ„ Ø¨Ø§Ø²ÛŒ Ø¨Ø§ ØªÙˆÙ¾ Ø¨ÙˆØ¯Ù†Ø¯. Ù†Ø§Ú¯Ù‡Ø§Ù†ØŒ ÛŒÚ© Ø­Ø¨Ø§Ø¨ ØµØ§Ø¨ÙˆÙ†ÛŒ Ø¨Ø²Ø±Ú¯ Ùˆ Ø¯Ø±Ø®Ø´Ø§Ù† Ø§Ø² Ø¢Ø³Ù…Ø§Ù† Ù¾Ø§ÛŒÛŒÙ† Ø¢Ù…Ø¯ Ùˆ Ú¯ÙØª: Â«Ù…Ù† Ø­Ø¨Ø§Ø¨ Ø´Ø¬Ø§Ø¹Ù…ØŒ Ù†Ú¯Ù‡Ø¨Ø§Ù† Ø´Ù‡Ø± ØªÙ…ÛŒØ²! Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø¨Ù‡ Ø´Ù‡Ø±ÛŒ Ø³ÙØ± Ú©Ù†ÛŒØ¯ Ú©Ù‡ ÛŒØ§Ø¯ Ø¨Ú¯ÛŒØ±ÛŒØ¯ Ú†Ø·ÙˆØ± Ù…ÛŒÚ©Ø±ÙˆØ¨â€ŒÙ‡Ø§ÛŒ Ù†Ø§Ù…Ø±Ø¦ÛŒ Ø±Ùˆ Ø´Ú©Ø§Ø± Ú©Ù†ÛŒØ¯ Ùˆ Ø³Ø§Ù„Ù… Ø¨Ù…Ø§Ù†ÛŒØ¯ØŸÂ» Ø¢ÙˆØ§ Ø¨Ø§ Ù‡ÛŒØ¬Ø§Ù† Ú¯ÙØª: Â«ÙˆØ§ÛŒØŒ Ù…ÛŒÚ©Ø±ÙˆØ¨ Ø´Ú©Ø§Ø± Ú©Ø±Ø¯Ù†ØŸ Ø®ÛŒÙ„ÛŒ Ø¨Ø§Ø­Ø§Ù„Ù‡!Â» Ø¢Ø±ØªÛŒÙ† Ù‡Ù… Ù¾Ø±ÛŒØ¯ Ùˆ Ú¯ÙØª: Â«Ø¨Ù„Ù‡ØŒ Ø¨Ø±ÛŒÙ…!Â» Ø­Ø¨Ø§Ø¨ Ø´Ø¬Ø§Ø¹ Ø¢Ù†â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ø§ ÛŒÚ© ÙˆØ²Ø´ Ø¬Ø§Ø¯ÙˆÛŒÛŒ Ø¨Ù‡ Ø´Ù‡Ø± ØªÙ…ÛŒØ² Ø¨Ø±Ø¯ØŒ Ø¬Ø§ÛŒÛŒ Ú©Ù‡ Ù‡Ù…Ù‡â€ŒÚ†ÛŒØ² Ù¾Ø± Ø§Ø² Ú©Ùâ€ŒÙ‡Ø§ÛŒ Ø±Ù†Ú¯Ø§Ø±Ù†Ú¯ Ùˆ Ø¨ÙˆÛŒ ØµØ§Ø¨ÙˆÙ† Ø¨ÙˆØ¯!\nØ­Ø¨Ø§Ø¨ Ú¯ÙØª: Â«Ø§ÛŒÙ†Ø¬Ø§ Ø´Ù‡Ø± ØªÙ…ÛŒØ²Ù‡! Ù…ÛŒÚ©Ø±ÙˆØ¨â€ŒÙ‡Ø§ÛŒ Ù†Ø§Ù…Ø±Ø¦ÛŒ Ù‡Ù…Ù‡â€ŒØ¬Ø§ Ù‚Ø§ÛŒÙ… Ø´Ø¯Ù†ØŒ ÙˆÙ„ÛŒ Ø´Ù…Ø§ Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒØ¯ Ø¨Ø§ Ø´Ø³ØªÙ† Ø¯Ø³Øªâ€ŒÙ‡Ø§ØªÙˆÙ† Ø§ÙˆÙ†Ø§ Ø±Ùˆ Ø´Ú©Ø³Øª Ø¨Ø¯ÛŒØ¯. Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ§ÛŒØ¯ØŸÂ»", tip: "Ù…Ø¹Ø±ÙÛŒ Ø§Ù‡Ù…ÛŒØª Ø´Ø³ØªØ´ÙˆÛŒ Ø¯Ø³Øª Ø¨Ø±Ø§ÛŒ Ù¾ÛŒØ´Ú¯ÛŒØ±ÛŒ Ø§Ø² Ø¨ÛŒÙ…Ø§Ø±ÛŒâ€ŒÙ‡Ø§ Ùˆ Ø¬Ù„Ø¨ ØªÙˆØ¬Ù‡ Ú©ÙˆØ¯Ú©Ø§Ù† Ø¨Ø§ ÛŒÚ© Ø¯Ù†ÛŒØ§ÛŒ Ø®ÛŒØ§Ù„ÛŒ." },
                    { type: "qa", title: "Ø¢Ø²Ù…ÙˆÙ† Ù…ÛŒÚ©Ø±ÙˆØ¨â€ŒØ´Ù†Ø§Ø³ÛŒ", questions: [{ q: "Ù…ÛŒÚ©Ø±ÙˆØ¨â€ŒÙ‡Ø§ Ø¨ÛŒØ´ØªØ± Ø±ÙˆÛŒ Ú©Ø¯Ø§Ù… ÛŒÚ© Ø§Ø² Ø§ÛŒÙ†â€ŒÙ‡Ø§ Ù‚Ø§ÛŒÙ… Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ØŸ", options: ["Ú©ØªØ§Ø¨ ØªÙ…ÛŒØ²", "Ø¯Ø³ØªÚ¯ÛŒØ±Ù‡ Ø¯Ø±", "Ø³ÛŒØ¨ Ø´Ø³ØªÙ‡ Ø´Ø¯Ù‡"], correct: "Ø¯Ø³ØªÚ¯ÛŒØ±Ù‡ Ø¯Ø±", points: 10 }] },
                    { type: "dragDrop", title: "Ù…Ø±Ø§Ø­Ù„ Ø´Ø³ØªÙ† Ø¯Ø³Øª", question: "Ù…Ø±Ø§Ø­Ù„ Ø´Ø³ØªÙ† Ø¯Ø³Øª Ø±Ø§ Ø¨Ù‡ ØªØ±ØªÛŒØ¨ Ø¯Ø±Ø³Øª Ø¯Ø± Ú©Ø§Ø¯Ø± Ø²ÛŒØ± Ù‚Ø±Ø§Ø± Ø¨Ø¯Ù‡.", items: [{ id: "soap", text: "ØµØ§Ø¨ÙˆÙ† Ø²Ø¯Ù†", category: "2" }, { id: "dry", text: "Ø®Ø´Ú© Ú©Ø±Ø¯Ù†", category: "4" }, { id: "water", text: "Ø®ÛŒØ³ Ú©Ø±Ø¯Ù† Ø¨Ø§ Ø¢Ø¨", category: "1" }, { id: "rub", text: "Ù…Ø§Ù„Ø´ Ø¯Ø³Øªâ€ŒÙ‡Ø§", category: "3" }], dropzones: [{ id: "step1", text: "Ù…Ø±Ø­Ù„Ù‡ Ø§ÙˆÙ„", accepts: "1" }, { id: "step2", text: "Ù…Ø±Ø­Ù„Ù‡ Ø¯ÙˆÙ…", accepts: "2" }, { id: "step3", text: "Ù…Ø±Ø­Ù„Ù‡ Ø³ÙˆÙ…", accepts: "3" }, { id: "step4", text: "Ù…Ø±Ø­Ù„Ù‡ Ú†Ù‡Ø§Ø±Ù…", accepts: "4" }], points: 20 }
            ] },
            { id: 4, title: "Ù†Ú¯Ù‡Ø¨Ø§Ù†Ø§Ù† Ø³Ù„Ø§Ù…Øª", icon: "ğŸ›¡ï¸", themeColor: "bg-gradient-to-br from-violet-500 to-purple-500", characterIntro: "Ø¨Ø§ Ø³Ø§Ø±Ø§ØŒ Ø³Ø§Ù… Ùˆ Ù¾Ø±Ù†Ø¯Ù‡ Ø³Ù„Ø§Ù…Øª Ù‡Ù…Ø±Ø§Ù‡ Ø´ÙˆÛŒØ¯...", content: [
                    { type: "narrative", title: "Ø¯Ø¹ÙˆØª Ø¨Ù‡ Ø³Ø±Ø²Ù…ÛŒÙ† Ø³Ù„Ø§Ù…Øª", text: "Ø±ÙˆØ²ÛŒ Ø³Ø§Ø±Ø§ Ùˆ Ø³Ø§Ù…ØŒ Ø¯Ùˆ Ø¯ÙˆØ³Øª 9 Ø³Ø§Ù„Ù‡ØŒ Ø¯Ø± Ø­ÛŒØ§Ø· Ù…Ø¯Ø±Ø³Ù‡ Ù…Ø´ØºÙˆÙ„ Ø¨Ø§Ø²ÛŒ Ø¨Ø§ ØªÙˆÙ¾ Ø¨ÙˆØ¯Ù†Ø¯. Ù†Ø§Ú¯Ù‡Ø§Ù†ØŒ ÛŒÚ© Ù¾Ø±Ù†Ø¯Ù‡ Ú©ÙˆÚ†Ú© Ø¨Ø§ Ø¨Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ø±Ù†Ú¯Ø§Ø±Ù†Ú¯ Ùˆ ÛŒÚ© Ø´Ù†Ù„ Ø¢Ø¨ÛŒ Ø¨Ø±Ø§Ù‚ Ø§Ø² Ø¢Ø³Ù…Ø§Ù† Ù¾Ø§ÛŒÛŒÙ† Ø¢Ù…Ø¯ Ùˆ Ú¯ÙØª: Â«Ù…Ù† Ù¾Ø±Ù†Ø¯Ù‡ Ø³Ù„Ø§Ù…Øªâ€ŒØ§Ù…ØŒ Ù†Ú¯Ù‡Ø¨Ø§Ù† Ø³Ø±Ø²Ù…ÛŒÙ† Ø³Ù„Ø§Ù…Øª! Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø¨Ù‡ Ø¬Ø§ÛŒÛŒ Ø³ÙØ± Ú©Ù†ÛŒØ¯ Ú©Ù‡ ÛŒØ§Ø¯ Ø¨Ú¯ÛŒØ±ÛŒØ¯ Ú†Ø·ÙˆØ± Ø§Ø² Ø¨ÛŒÙ…Ø§Ø±ÛŒâ€ŒÙ‡Ø§ÛŒ ÙˆØ§Ú¯ÛŒØ± Ù…Ø«Ù„ Ø³Ø±Ù…Ø§Ø®ÙˆØ±Ø¯Ú¯ÛŒ Ùˆ Ø¢Ø¨Ù„Ù‡â€ŒÙ…Ø±ØºØ§Ù† Ø¯ÙˆØ± Ø¨Ù…Ø§Ù†ÛŒØ¯ØŸÂ»", tip: "Ù…Ø¹Ø±ÙÛŒ Ø¨ÛŒÙ…Ø§Ø±ÛŒâ€ŒÙ‡Ø§ÛŒ ÙˆØ§Ú¯ÛŒØ± Ùˆ Ø±Ø§Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ù†ØªÙ‚Ø§Ù„ Ù…ÛŒÚ©Ø±ÙˆØ¨." },
                    { type: "qa", title: "Ø¢Ø²Ù…ÙˆÙ† Ù¾ÛŒØ´Ú¯ÛŒØ±ÛŒ", questions: [{ q: "Ø¨Ù‡ØªØ±ÛŒÙ† Ú©Ø§Ø± Ù…ÙˆÙ‚Ø¹ Ø¹Ø·Ø³Ù‡ Ú©Ø±Ø¯Ù† ÙˆÙ‚ØªÛŒ Ø¯Ø³ØªÙ…Ø§Ù„ Ù†Ø¯Ø§Ø±ÛŒÙ… Ú†ÛŒØ³ØªØŸ", options: ["Ø¹Ø·Ø³Ù‡ Ø¯Ø± Ù‡ÙˆØ§", "Ø¹Ø·Ø³Ù‡ Ø¯Ø± Ø¯Ø³Øª", "Ø¹Ø·Ø³Ù‡ Ø¯Ø± Ø¢Ø±Ù†Ø¬"], correct: "Ø¹Ø·Ø³Ù‡ Ø¯Ø± Ø¢Ø±Ù†Ø¬", points: 10 }] },
                    { type: "dragDrop", title: "Ø¬ÙØªâ€ŒÙ‡Ø§ÛŒ Ø¨Ù‡Ø¯Ø§Ø´ØªÛŒ", question: "Ù‡Ø± Ú©Ø§Ø± Ø±Ø§ Ø¨Ù‡ Ø¯Ù„ÛŒÙ„ Ø¨Ù‡Ø¯Ø§Ø´ØªÛŒ Ø¢Ù† ÙˆØµÙ„ Ú©Ù†.", items: [{ id: "wash", text: "Ø´Ø³ØªÙ† Ø¯Ø³Øª", category: "germs" }, { id: "distance", text: "ÙØ§ØµÙ„Ù‡ Ú¯Ø±ÙØªÙ†", category: "sick" }, { id: "tissues", text: "Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø¯Ø³ØªÙ…Ø§Ù„", category: "sneeze" }], dropzones: [{ id: "dz-germs", text: "Ø¨Ø±Ø§ÛŒ Ú©Ø´ØªÙ† Ù…ÛŒÚ©Ø±ÙˆØ¨â€ŒÙ‡Ø§", accepts: "wash" }, { id: "dz-sick", text: "Ø§Ø² ÙØ±Ø¯ Ø¨ÛŒÙ…Ø§Ø±", accepts: "distance" }, { id: "dz-sneeze", text: "Ù‡Ù†Ú¯Ø§Ù… Ø¹Ø·Ø³Ù‡", accepts: "tissues" }], points: 15 }
            ] },
            { id: 5, title: "Ù†Ú¯Ù‡Ø¨Ø§Ù†Ø§Ù† Ø³Ø¨Ø²", icon: "ğŸŒ³", themeColor: "bg-gradient-to-br from-green-500 to-emerald-500", characterIntro: "Ø¨Ø§ Ù„ÛŒÙ„ÛŒØŒ Ø¢Ø±ÛŒÙ† Ùˆ Ù¾Ø±ÙˆØ§Ù†Ù‡ Ø³Ø¨Ø² Ù‡Ù…Ø±Ø§Ù‡ Ø´ÙˆÛŒØ¯...", content: [
                    { type: "narrative", title: "Ø¯Ø¹ÙˆØª Ø¨Ù‡ Ø³Ø±Ø²Ù…ÛŒÙ† Ø³Ø¨Ø²", text: "Ø±ÙˆØ²ÛŒ Ù„ÛŒÙ„ÛŒ Ùˆ Ø¢Ø±ÛŒÙ†ØŒ Ø¯Ùˆ Ø¯ÙˆØ³Øª 8 Ø³Ø§Ù„Ù‡ØŒ Ø¯Ø± Ù¾Ø§Ø±Ú© Ù†Ø²Ø¯ÛŒÚ© Ù…Ø¯Ø±Ø³Ù‡ Ù…Ø´ØºÙˆÙ„ Ø¨Ø§Ø²ÛŒ Ø¨Ø§ Ø·Ù†Ø§Ø¨ Ø¨ÙˆØ¯Ù†Ø¯. Ù†Ø§Ú¯Ù‡Ø§Ù†ØŒ ÛŒÚ© Ù¾Ø±ÙˆØ§Ù†Ù‡ Ø¨Ø²Ø±Ú¯ Ø¨Ø§ Ø¨Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ø±Ù†Ú¯Ø§Ø±Ù†Ú¯ Ùˆ ÛŒÚ© ØªØ§Ø¬ Ø³Ø¨Ø² Ø¨Ø±Ø§Ù‚ Ø§Ø² Ø±ÙˆÛŒ Ú¯Ù„â€ŒÙ‡Ø§ Ù¾Ø±ÙˆØ§Ø² Ú©Ø±Ø¯ Ùˆ Ú¯ÙØª: Â«Ù…Ù† Ù¾Ø±ÙˆØ§Ù†Ù‡ Ø³Ø¨Ø²Ù…ØŒ Ù†Ú¯Ù‡Ø¨Ø§Ù† Ø³Ø±Ø²Ù…ÛŒÙ† Ø³Ø¨Ø²! Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø¨Ù‡ Ø¬Ø§ÛŒÛŒ Ø³ÙØ± Ú©Ù†ÛŒØ¯ Ú©Ù‡ ÛŒØ§Ø¯ Ø¨Ú¯ÛŒØ±ÛŒØ¯ Ú†Ø·ÙˆØ± Ø§Ø² Ù…Ø­ÛŒØ· Ø²ÛŒØ³ØªØŒ Ù…Ø«Ù„ Ø¯Ø±Ø®Øªâ€ŒÙ‡Ø§ØŒ Ø­ÛŒÙˆØ§Ù†Ø§ØªØŒ Ø±ÙˆØ¯Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ Ùˆ Ù‡ÙˆØ§ Ù…Ø±Ø§Ù‚Ø¨Øª Ú©Ù†ÛŒØ¯ØŸÂ»", tip: "Ù…Ø­ÛŒØ· Ø²ÛŒØ³Øª Ø´Ø§Ù…Ù„ Ù‡Ù…Ù‡ Ú†ÛŒØ² Ø§Ø·Ø±Ø§Ù Ù…Ø§Ø³Øª Ùˆ Ù…Ø±Ø§Ù‚Ø¨Øª Ø§Ø² Ø¢Ù† Ø¶Ø±ÙˆØ±ÛŒ Ø§Ø³Øª." },
                    { type: "dragDrop", title: "ØªÙÚ©ÛŒÚ© Ø²Ø¨Ø§Ù„Ù‡", question: "Ù‡Ø± Ø²Ø¨Ø§Ù„Ù‡ Ø±Ø§ Ø¯Ø± Ø³Ø·Ù„ Ø¯Ø±Ø³Øª (ØªØ± ÛŒØ§ Ø®Ø´Ú©) Ø¨ÛŒÙ†Ø¯Ø§Ø².", items: [{ id: "banana", text: "Ù¾ÙˆØ³Øª Ù…ÙˆØ²", category: "wet" }, { id: "bottle", text: "Ø¨Ø·Ø±ÛŒ Ù¾Ù„Ø§Ø³ØªÛŒÚ©ÛŒ", category: "dry" }, { id: "paper", text: "Ú©Ø§ØºØ° Ø¨Ø§Ø·Ù„Ù‡", category: "dry" }, { id: "apple-core", text: "Ø¨Ø§Ù‚ÛŒÙ…Ø§Ù†Ø¯Ù‡ Ø³ÛŒØ¨", category: "wet" }], dropzones: [{ id: "dz-dry", text: "Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ø®Ø´Ú©", accepts: "dry" }, { id: "dz-wet", text: "Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ ØªØ±", accepts: "wet" }], points: 20 },
                    { type: "qa", title: "Ø¢Ø²Ù…ÙˆÙ† Ù…Ø­ÛŒØ· Ø²ÛŒØ³Øª", questions: [{ q: "Ø¨Ø±Ø§ÛŒ ØµØ±ÙÙ‡â€ŒØ¬ÙˆÛŒÛŒ Ø¯Ø± Ù…ØµØ±Ù Ú©Ø§ØºØ° Ú†Ù‡ Ú©Ø§Ø± Ø®ÙˆØ¨ÛŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒÙ… Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡ÛŒÙ…ØŸ", options: ["Ø±ÙˆÛŒ ÛŒÚ© Ø·Ø±Ù Ø¢Ù† Ù†Ù‚Ø§Ø´ÛŒ Ú©Ù†ÛŒÙ…", "Ø¢Ù† Ø±Ø§ Ù…Ú†Ø§Ù„Ù‡ Ú©Ù†ÛŒÙ… Ùˆ Ø¯ÙˆØ± Ø¨ÛŒÙ†Ø¯Ø§Ø²ÛŒÙ…", "Ø±ÙˆÛŒ Ù‡Ø± Ø¯Ùˆ Ø·Ø±Ù Ø¢Ù† Ø¨Ù†ÙˆÛŒØ³ÛŒÙ… ÛŒØ§ Ù†Ù‚Ø§Ø´ÛŒ Ú©Ù†ÛŒÙ…"], correct: "Ø±ÙˆÛŒ Ù‡Ø± Ø¯Ùˆ Ø·Ø±Ù Ø¢Ù† Ø¨Ù†ÙˆÛŒØ³ÛŒÙ… ÛŒØ§ Ù†Ù‚Ø§Ø´ÛŒ Ú©Ù†ÛŒÙ…", points: 10 }] }
            ] },
            { id: 6, title: "Ù†Ú¯Ù‡Ø¨Ø§Ù†Ø§Ù† Ø§ÛŒÙ…Ù†ÛŒ", icon: "â›‘ï¸", themeColor: "bg-gradient-to-br from-rose-500 to-pink-500", characterIntro: "Ø¨Ø§ Ø³ÙˆÙÛŒØŒ Ø³Ø§Ù…ÛŒ Ùˆ Ø±ÙˆØ¨Ø§Ù‡ Ø§ÛŒÙ…Ù†ÛŒ Ù‡Ù…Ø±Ø§Ù‡ Ø´ÙˆÛŒØ¯...", content: [
                    { type: "narrative", title: "Ø¯Ø¹ÙˆØª Ø¨Ù‡ Ø´Ù‡Ø± Ø§ÛŒÙ…Ù†ÛŒ", text: "Ø±ÙˆØ²ÛŒ Ø³ÙˆÙÛŒ Ùˆ Ø³Ø§Ù…ÛŒØŒ Ø¯Ùˆ Ø¯ÙˆØ³Øª 9 Ø³Ø§Ù„Ù‡ØŒ Ø¯Ø± Ø­ÛŒØ§Ø· Ù…Ø¯Ø±Ø³Ù‡ Ù…Ø´ØºÙˆÙ„ Ø¨Ø§Ø²ÛŒ Ø¨Ø§ ØªÙˆÙ¾ Ø¨ÙˆØ¯Ù†Ø¯. Ù†Ø§Ú¯Ù‡Ø§Ù†ØŒ ÛŒÚ© Ø±ÙˆØ¨Ø§Ù‡ Ú©ÙˆÚ†ÙˆÙ„Ùˆ Ø¨Ø§ ÛŒÙ‡ Ú©Ù„Ø§Ù‡ Ø§ÛŒÙ…Ù†ÛŒ Ø²Ø±Ø¯ Ø¨Ø±Ø§Ù‚ Ø§Ø² Ù¾Ø´Øª Ø¯Ø±Ø®Øª Ù¾Ø±ÛŒØ¯ Ùˆ Ú¯ÙØª: Â«Ù…Ù† Ø±ÙˆØ¨Ø§Ù‡ Ø§ÛŒÙ…Ù†ÛŒâ€ŒØ§Ù…ØŒ Ù†Ú¯Ù‡Ø¨Ø§Ù† Ø´Ù‡Ø± Ø§ÛŒÙ…Ù†ÛŒ! Ù…ÛŒâ€ŒØ®ÙˆØ§ÛŒØ¯ Ø¨Ù‡ Ø¬Ø§ÛŒÛŒ Ø³ÙØ± Ú©Ù†ÛŒØ¯ Ú©Ù‡ ÛŒØ§Ø¯ Ø¨Ú¯ÛŒØ±ÛŒØ¯ Ú†Ø·ÙˆØ± Ø§Ø² Ø­ÙˆØ§Ø¯Ø« Ù…Ø«Ù„ ØªØµØ§Ø¯ÙØŒ Ø³Ù‚ÙˆØ· ÛŒØ§ Ø³ÙˆØ®ØªÚ¯ÛŒ Ø¯Ø± Ø§Ù…Ø§Ù† Ø¨Ù…ÙˆÙ†ÛŒØ¯ØŸÂ»", tip: "Ø­ÙˆØ§Ø¯Ø« ØºÛŒØ±Ù…Ù†ØªØ¸Ø±Ù‡ Ù‚Ø§Ø¨Ù„ Ù¾ÛŒØ´Ú¯ÛŒØ±ÛŒ Ù‡Ø³ØªÙ†Ø¯." },
                    { type: "qa", title: "Ø¢Ø²Ù…ÙˆÙ† Ø§ÛŒÙ…Ù†ÛŒ", questions: [{ q: "Ù‡Ù†Ú¯Ø§Ù… Ø¹Ø¨ÙˆØ± Ø§Ø² Ø®ÛŒØ§Ø¨Ø§Ù† Ø§ÙˆÙ„ÛŒÙ† Ú©Ø§Ø±ÛŒ Ú©Ù‡ Ø¨Ø§ÛŒØ¯ Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡ÛŒÙ… Ú†ÛŒØ³ØªØŸ", options: ["Ø¯ÙˆÛŒØ¯Ù† Ø³Ø±ÛŒØ¹", "Ù†Ú¯Ø§Ù‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ú†Ù¾ Ùˆ Ø±Ø§Ø³Øª", "Ø¨Ø§Ø²ÛŒ Ú©Ø±Ø¯Ù†"], correct: "Ù†Ú¯Ø§Ù‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ú†Ù¾ Ùˆ Ø±Ø§Ø³Øª", points: 10 }] },
                    { type: "dragDrop", title: "Ø¬ÙˆØ±Ú†ÛŒÙ† Ø´Ù…Ø§Ø±Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø¶Ø·Ø±Ø§Ø±ÛŒ", question: "Ù‡Ø± Ø´Ù…Ø§Ø±Ù‡ Ø±Ø§ Ø¨Ù‡ Ø³Ø§Ø²Ù…Ø§Ù† Ù…Ø±Ø¨ÙˆØ·Ù‡ ÙˆØµÙ„ Ú©Ù†.", items: [{ id: "115", text: "115", category: "emergency" }, { id: "125", text: "125", category: "fire" }, { id: "110", text: "110", category: "police" }], dropzones: [{ id: "dz-emergency", text: "Ø§ÙˆØ±Ú˜Ø§Ù†Ø³", accepts: "emergency" }, { id: "dz-fire", text: "Ø¢ØªØ´â€ŒÙ†Ø´Ø§Ù†ÛŒ", accepts: "fire" }, { id: "dz-police", text: "Ù¾Ù„ÛŒØ³", accepts: "police" }], points: 15 }
            ] }
        ];
        // --- DOM ELEMENTS ---
        const mainContent = document.getElementById('main-content');
        const storyLocationsContainer = document.getElementById('story-locations');
        const storyScreen = document.getElementById('story-screen');
        const adventureMapContainer = document.getElementById('adventure-map-container');
        const storyTitleEl = document.getElementById('story-title');
        const storyCharacterIntroEl = document.getElementById('story-character-intro');
        const storyContentContainer = document.getElementById('story-content-container');
        const totalScoreEl = document.getElementById('total-score');
        const welcomeMessageEl = document.getElementById('welcome-message');
        const homeBtn = document.getElementById('home-btn');
        // Modals
        const feedbackModal = document.getElementById('feedback-modal');
        const modalMessage = document.getElementById('modal-message');
        const closeModalBtn = document.getElementById('close-modal');
        const welcomeModal = document.getElementById('welcome-modal');
        const nameInput = document.getElementById('name-input');
        const startAdventureBtn = document.getElementById('start-adventure-btn');
        const chatbotModal = document.getElementById('chatbot-modal');
        const medalsModal = document.getElementById('medals-modal');
        const aboutModal = document.getElementById('about-modal');
        // Modal Buttons
        const medalsBtn = document.getElementById('medals-btn');
        const closeMedalsModalBtn = document.getElementById('close-medals-modal');
        const aboutMapToggleBtn = document.getElementById('about-map-toggle');
        const closeAboutModalBtn = document.getElementById('close-about-modal');
        const chatbotMapToggleBtn = document.getElementById('chatbot-map-toggle');
        // Chatbot
        const chatMessagesContainer = document.getElementById('chat-messages');
        const chatInput = document.getElementById('chat-input');
        const chatSendBtn = document.getElementById('chat-send-btn');
        // Medal Gallery
        const medalGalleryContent = document.getElementById('medal-gallery-content');
        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            loadGameState();
            renderAdventureMap();
            renderMedalGallery();
            updateScore(0);
            addEventListeners();
        });
        // --- STATE MANAGEMENT ---
        function saveGameState() {
            const gameState = {
                totalScore,
                userName,
                unlockedMedals: MEDAL_THRESHOLDS.filter(m => m.unlocked).map(m => m.name)
            };
            localStorage.setItem('healthHeroesGameState', JSON.stringify(gameState));
        }
        function loadGameState() {
            const savedState = localStorage.getItem('healthHeroesGameState');
            if (savedState) {
                try {
                    const gameState = JSON.parse(savedState);
                    totalScore = gameState.totalScore || 0;
                    userName = gameState.userName || "Ù‚Ù‡Ø±Ù…Ø§Ù†";
                    if (gameState.unlockedMedals) {
                        MEDAL_THRESHOLDS.forEach(medal => {
                            if (gameState.unlockedMedals.includes(medal.name)) {
                                medal.unlocked = true;
                            }
                        });
                    }
                    welcomeModal.style.display = 'none';
                    updateWelcomeMessage();
                }
                catch (error) {
                    console.error("Failed to parse saved game state, resetting.", error);
                    localStorage.removeItem('healthHeroesGameState');
                    // Show welcome modal to start over
                    welcomeModal.style.display = 'flex';
                }
            }
            else {
                welcomeModal.style.display = 'flex';
            }
        }
        // --- UI RENDERING ---
        function updateWelcomeMessage() {
            welcomeMessageEl.textContent = `Ø³Ù„Ø§Ù… ${userName}! Ø¨Ù‡ Ø³Ø±Ø²Ù…ÛŒÙ† Ø³Ù„Ø§Ù…Øª Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒ.`;
        }
        function renderAdventureMap() {
            storyLocationsContainer.innerHTML = '';
            storiesData.forEach(story => {
                const locationEl = document.createElement('div');
                locationEl.className = 'map-location';
                locationEl.innerHTML = `
            <div class="icon-container ${story.themeColor}">${story.icon}</div>
            <div class="title-container">${story.title}</div>
        `;
                locationEl.addEventListener('click', () => showStory(story.id));
                storyLocationsContainer.appendChild(locationEl);
            });
        }
        function renderMedalGallery() {
            medalGalleryContent.innerHTML = '';
            MEDAL_THRESHOLDS.forEach(medal => {
                const medalEl = document.createElement('div');
                medalEl.className = 'flex flex-col items-center text-center';
                const isUnlocked = medal.unlocked;
                medalEl.innerHTML = `
            <div class="w-16 h-16 rounded-full flex items-center justify-center text-4xl ${isUnlocked ? '' : 'grayscale opacity-50'}" style="background-color: ${medal.color};">
                ${isUnlocked ? 'ğŸ†' : 'â“'}
            </div>
            <span class="mt-2 text-xs font-semibold ${isUnlocked ? 'text-slate-700' : 'text-slate-400'}">${medal.name}</span>
            <span class="text-xs text-slate-400">${medal.score} Ø§Ù…ØªÛŒØ§Ø²</span>`;
                medalGalleryContent.appendChild(medalEl);
            });
        }
        function showStory(storyId) {
            currentStoryId = storyId;
            const story = storiesData.find(s => s.id === storyId);
            if (!story)
                return;
            storyTitleEl.textContent = story.title;
            storyCharacterIntroEl.textContent = story.characterIntro;
            renderStoryContent(story.content);
            adventureMapContainer.classList.add('hidden');
            storyScreen.classList.remove('hidden');
            storyScreen.classList.add('flex');
            mainContent.scrollTop = 0;
        }
        function renderStoryContent(content) {
            storyContentContainer.innerHTML = '';
            content.forEach((item, index) => {
                const section = document.createElement('div');
                section.className = 'story-section animate-fade-in';
                section.style.animationDelay = `${index * 100}ms`;
                switch (item.type) {
                    case 'narrative':
                        section.innerHTML = `<h3 class="text-xl font-bold text-slate-800 mb-4">${item.title}</h3><p class="text-slate-600 leading-relaxed whitespace-pre-line">${item.text}</p>`;
                        break;
                    case 'qa':
                        section.innerHTML = `<h3 class="text-xl font-bold text-slate-800 mb-4">${item.title}</h3>${item.questions.map((q, qIndex) => `<div class="qa-container mt-4" data-points="${q.points}" data-question-index="${qIndex}"><p class="font-semibold mb-3">${q.q}</p><div class="space-y-2">${q.options.map(opt => `<button class="qa-option">${opt}</button>`).join('')}</div></div>`).join('')}`;
                        break;
                    case 'dragDrop':
                        section.innerHTML = `<h3 class="text-xl font-bold text-slate-800 mb-4">${item.title}</h3><p class="text-slate-600 mb-4">${item.question}</p><div class="flex flex-col md:flex-row gap-4"><div class="w-full md:w-1/3 p-4 bg-slate-100 rounded-lg space-y-3" id="drag-items-${index}">${item.items.map(i => `<div class="draggable bg-white p-3 rounded-lg shadow-sm" draggable="true" data-item-id="${i.id}" data-category="${i.category}">${i.text}</div>`).join('')}</div><div class="w-full md:w-2/3 space-y-3" id="drop-zones-${index}">${item.dropzones.map(dz => `<div class="dropzone p-6 text-center" data-accepts="${dz.accepts}"><span class="font-semibold text-slate-500">${dz.text}</span></div>`).join('')}</div></div><button class="btn btn-primary mt-6 check-drag-drop-btn" data-section-index="${index}" data-points="${item.points}">Ø¨Ø±Ø±Ø³ÛŒ Ø¬ÙˆØ§Ø¨</button>`;
                        break;
                }
                storyContentContainer.appendChild(section);
            });
            addActivityListeners();
        }
        function showHomeScreen() {
            storyScreen.classList.add('hidden');
            storyScreen.classList.remove('flex');
            adventureMapContainer.classList.remove('hidden');
        }
        // --- EVENT LISTENERS & HANDLERS ---
        function addEventListeners() {
            homeBtn.addEventListener('click', showHomeScreen);
            // Modal Toggles
            medalsBtn.addEventListener('click', () => medalsModal.style.display = 'flex');
            closeMedalsModalBtn.addEventListener('click', () => medalsModal.style.display = 'none');
            aboutMapToggleBtn.addEventListener('click', () => aboutModal.style.display = 'flex');
            closeAboutModalBtn.addEventListener('click', () => aboutModal.style.display = 'none');
            chatbotMapToggleBtn.addEventListener('click', openChatbot);
            
            const changeNameBtn = document.getElementById('change-name-btn');
            changeNameBtn.addEventListener('click', () => {
                aboutModal.style.display = 'none';
                welcomeModal.style.display = 'flex';
                nameInput.value = userName;
                nameInput.focus();
            });

            // Welcome Modal
            startAdventureBtn.addEventListener('click', () => {
                const name = nameInput.value.trim();
                if (name) {
                    userName = name;
                    updateWelcomeMessage();
                    saveGameState();
                    welcomeModal.style.display = 'none';
                }
                else {
                    nameInput.placeholder = "Ù„Ø·ÙØ§ Ø§Ø³Ù…Øª Ø±Ùˆ Ø¨Ù†ÙˆÛŒØ³!";
                    nameInput.classList.add('border-red-500');
                }
            });
            // Feedback Modal
            closeModalBtn.addEventListener('click', () => feedbackModal.style.display = 'none');
            // Chatbot
            chatSendBtn.addEventListener('click', handleChatSend);
            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter')
                    handleChatSend();
            });
            chatbotModal.addEventListener('click', (e) => {
                if (e.target === chatbotModal)
                    chatbotModal.style.display = 'none';
            });
        }
        function addActivityListeners() {
            document.querySelectorAll('.qa-option').forEach(button => button.addEventListener('click', handleQA));
            let draggedItem = null;
            document.querySelectorAll('.draggable').forEach(item => {
                item.addEventListener('dragstart', e => {
                    draggedItem = e.target;
                    setTimeout(() => e.target.style.display = 'none', 0);
                });
                item.addEventListener('dragend', e => {
                    setTimeout(() => { e.target.style.display = 'block'; draggedItem = null; }, 0);
                });
            });
            document.querySelectorAll('.dropzone').forEach(zone => {
                zone.addEventListener('dragover', e => { e.preventDefault(); zone.classList.add('hover'); });
                zone.addEventListener('dragleave', () => zone.classList.remove('hover'));
                zone.addEventListener('drop', e => {
                    e.preventDefault();
                    zone.classList.remove('hover');
                    if (draggedItem && !zone.querySelector('.draggable')) {
                        zone.appendChild(draggedItem);
                    }
                });
            });
            document.querySelectorAll('.check-drag-drop-btn').forEach(btn => btn.addEventListener('click', handleCheckDragDrop));
        }
        function handleQA(event) {
            const button = event.target;
            const container = button.closest('.qa-container');
            const qIndex = parseInt(container.dataset.questionIndex, 10);
            const story = storiesData.find(s => s.id === currentStoryId);
            const questionData = story?.content.find(c => c.type === 'qa');
            if (!questionData)
                return;
            const question = questionData.questions[qIndex];
            const isCorrect = button.textContent === question.correct;
            const points = parseInt(container.dataset.points, 10);
            if (isCorrect) {
                button.classList.add('correct');
                updateScore(points);
                showFeedbackModal(`Ø¢ÙØ±ÛŒÙ†! Ø¬ÙˆØ§Ø¨Øª Ø¯Ø±Ø³Øª Ø¨ÙˆØ¯ Ùˆ ${points} Ø§Ù…ØªÛŒØ§Ø² Ú¯Ø±ÙØªÛŒ.`);
            }
            else {
                button.classList.add('incorrect');
                showFeedbackModal('Ø§Ø´ØªØ¨Ø§Ù‡ Ø¨ÙˆØ¯ØŒ ÙˆÙ„ÛŒ Ù†Ú¯Ø±Ø§Ù† Ù†Ø¨Ø§Ø´! Ø¨Ù‡ Ù…Ø§Ø¬Ø±Ø§Ø¬ÙˆÛŒÛŒ Ø§Ø¯Ø§Ù…Ù‡ Ø¨Ø¯Ù‡.');
            }
            container.querySelectorAll('.qa-option').forEach(btn => {
                btn.disabled = true;
                if (btn.textContent === question.correct) {
                    btn.classList.add('correct');
                }
            });
        }
        function handleCheckDragDrop(event) {
            const button = event.target;
            const sectionIndex = button.dataset.sectionIndex;
            const points = parseInt(button.dataset.points, 10);
            const dropZones = document.querySelectorAll(`#drop-zones-${sectionIndex} .dropzone`);
            let correctDrops = 0;
            let totalItemsInZones = 0;
            dropZones.forEach(zone => {
                const droppedItem = zone.querySelector('.draggable');
                if (droppedItem) {
                    totalItemsInZones++;
                    if (droppedItem.dataset.category === zone.dataset.accepts) {
                        correctDrops++;
                        zone.style.borderColor = '#22c55e';
                    }
                    else {
                        zone.style.borderColor = '#ef4444';
                    }
                }
            });
            const allItems = document.querySelectorAll(`#drag-items-${sectionIndex} .draggable`);
            if (totalItemsInZones === allItems.length && correctDrops === totalItemsInZones) {
                updateScore(points);
                showFeedbackModal(`Ø¹Ø§Ù„ÛŒÙ‡! Ù‡Ù…Ù‡ Ø±Ùˆ Ø¯Ø±Ø³Øª Ú¯Ø°Ø§Ø´ØªÛŒ Ùˆ ${points} Ø§Ù…ØªÛŒØ§Ø² Ú¯Ø±ÙØªÛŒ.`);
                button.disabled = true;
            }
            else {
                showFeedbackModal('Ø¨Ø¹Ø¶ÛŒ Ø§Ø² Ù…ÙˆØ§Ø±Ø¯ Ø§Ø´ØªØ¨Ø§Ù‡Ù‡. Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ù†Ú¯Ø§Ù‡ Ú©Ù†!');
            }
        }
        // --- SCORE & MEDALS ---
        function updateScore(points) {
            if (points > 0)
                totalScore += points;
            totalScoreEl.textContent = totalScore.toString();
            totalScoreEl.classList.add('animate-pulse-once');
            setTimeout(() => totalScoreEl.classList.remove('animate-pulse-once'), 500);
            checkMedals();
            saveGameState();
        }
        function checkMedals() {
            let newMedalUnlocked = false;
            MEDAL_THRESHOLDS.forEach(medal => {
                if (!medal.unlocked && totalScore >= medal.score) {
                    medal.unlocked = true;
                    newMedalUnlocked = true;
                    showFeedbackModal(`ØªØ¨Ø±ÛŒÚ© ${userName}! Ø´Ù…Ø§ "${medal.name}" Ø±Ø§ Ø¨Ù‡ Ø¯Ø³Øª Ø¢ÙˆØ±Ø¯ÛŒØ¯! ğŸ…`);
                }
            });
            if (newMedalUnlocked) {
                renderMedalGallery();
            }
        }
        // --- MODALS ---
        function showFeedbackModal(message) {
            modalMessage.textContent = message;
            feedbackModal.style.display = 'flex';
        }
        // --- CHATBOT ---
        const SYSTEM_INSTRUCTION = `You are a friendly and encouraging health coach for children aged 7-10. Your name is 'Ù…Ø±Ø¨ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯' (Smart Coach). You MUST answer in Persian. Your goal is to answer questions about health, nutrition, exercise, and hygiene in a simple, positive, and easy-to-understand way. Keep your answers short (2-3 sentences), fun, and engaging. Always be supportive. You are NOT a medical professional. If asked a specific medical question or for a diagnosis, you MUST gently refuse and advise the child to talk to their parents, a teacher, or a doctor. For example: "Ø§ÛŒÙ† ÛŒÙ‡ Ø³ÙˆØ§Ù„ Ø®ÛŒÙ„ÛŒ Ù…Ù‡Ù…Ù‡! Ø¨Ù‡ØªØ±ÛŒÙ† Ú©Ø§Ø± Ø§ÛŒÙ†Ù‡ Ú©Ù‡ Ø¨Ø§ Ù¾Ø¯Ø± Ùˆ Ù…Ø§Ø¯Ø± ÛŒØ§ Ø¯Ú©ØªØ± ØµØ­Ø¨Øª Ú©Ù†ÛŒ ØªØ§ Ø¨Ù‡ØªØ±ÛŒÙ† Ø¬ÙˆØ§Ø¨ Ø±Ùˆ Ø¨Ú¯ÛŒØ±ÛŒ."`;
        function initializeChat() {
            if (chat)
                return;
            try {
                const ai = new GoogleGenAI({ apiKey: process.env.API_KEY });
                chat = ai.chats.create({
                    model: 'gemini-2.5-flash',
                    config: {
                        systemInstruction: SYSTEM_INSTRUCTION,
                    },
                });
            }
            catch (error) {
                console.error("Chat initialization failed:", error);
                addMessageToChat('bot', 'Ù…ØªØ§Ø³ÙØ§Ù†Ù‡ Ø§Ù„Ø§Ù† Ù†Ù…ÛŒâ€ŒØªÙˆÙ†Ù… ÙˆØµÙ„ Ø¨Ø´Ù…. Ù„Ø·ÙØ§ Ø¨Ø¹Ø¯Ø§ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†.');
            }
        }
        function openChatbot() {
            chatbotModal.style.display = 'flex';
            initializeChat();
            if (chatMessagesContainer.children.length === 0) {
                addMessageToChat('bot', `Ø³Ù„Ø§Ù… ${userName}! Ù…Ù† Ù…Ø±Ø¨ÛŒ Ø³Ù„Ø§Ù…Øª Ù‡ÙˆØ´Ù…Ù†Ø¯ ØªÙˆ Ù‡Ø³ØªÙ…. Ù‡Ø± Ø³Ø¤Ø§Ù„ÛŒ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø³Ù„Ø§Ù…ØªÛŒ Ø¯Ø§Ø±ÛŒ Ø¨Ù¾Ø±Ø³!`);
            }
        }
        async function handleChatSend() {
            const question = chatInput.value.trim();
            if (!question || chatSendBtn.disabled)
                return;
            if (!chat) {
                addMessageToChat('bot', 'Ø§ÙˆÙ‡! Ù…Ø´Ú©Ù„ÛŒ Ø¯Ø± Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ù…Ø±Ø¨ÛŒ Ù¾ÛŒØ´ Ø§ÙˆÙ…Ø¯Ù‡. Ù„Ø·ÙØ§ Ù¾Ù†Ø¬Ø±Ù‡ Ø±Ø§ Ø¨Ø¨Ù†Ø¯ Ùˆ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø¨Ø§Ø² Ú©Ù†.');
                return;
            }
            addMessageToChat('user', question);
            chatInput.value = '';
            const thinkingMsg = addMessageToChat('bot', '...');
            chatSendBtn.disabled = true;
            chatInput.disabled = true;
            try {
                const response = await chat.sendMessage({ message: question });
                thinkingMsg.textContent = response.text;
            }
            catch (error) {
                console.error("Chat API error:", error);
                thinkingMsg.textContent = 'Ø§ÙˆÙ‡! ÛŒÙ‡ Ù…Ø´Ú©Ù„ÛŒ Ù¾ÛŒØ´ Ø§ÙˆÙ…Ø¯. Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø³ÙˆØ§Ù„Øª Ø±Ùˆ Ø¨Ù¾Ø±Ø³ÛŒØŸ';
            }
            finally {
                chatSendBtn.disabled = false;
                chatInput.disabled = false;
                chatInput.focus();
            }
        }
        function addMessageToChat(sender, text) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `p-3 rounded-lg max-w-[85%] break-words ${sender === 'user' ? 'bg-blue-500 text-white self-end' : 'bg-slate-200 text-slate-800 self-start'}`;
            messageDiv.textContent = text;
            chatMessagesContainer.appendChild(messageDiv);
            chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight;
            return messageDiv;
        }
    </script>
</body>
</html>
